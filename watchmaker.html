<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Blind Watchmaker - Alex YalÄ±n</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/jpeg" href="assets/avatar.jpg">
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background-color: #080c10; color: #eee; }
        canvas { display: block; }
        .overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
            z-index: 10;
        }
        .overlay h1 {
            font-family: 'Inter', sans-serif;
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(50,200,100,0.3);
        }
        .overlay p {
            font-family: 'Lora', serif;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin: 5px 0 0 0;
        }
        .back-link {
            position: absolute;
            bottom: 20px;
            left: 20px;
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.4);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: all 0.3s;
            pointer-events: auto;
        }
        .back-link:hover {
            color: #fff;
            border-bottom-color: #fff;
        }
        .stats {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-family: 'Inter', sans-serif;
            font-size: 0.7rem;
            color: rgba(255,255,255,0.3);
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="overlay">
        <h1>The Blind Watchmaker</h1>
        <p>Evolution without design. Biomorphs drifting through genetic space.</p>
    </div>
    
    <div class="stats">
        Generation: <span id="gen">0</span><br>
        Gene Mutation Rate: 10%
    </div>

    <a href="gallery.html" class="back-link">&larr; Back to Gallery</a>

    <canvas id="bioCanvas"></canvas>

    <script>
        const canvas = document.getElementById('bioCanvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let generation = 0;
        
        // Genes: [Length, Angle, Ratio, Branches, Symmetry, Oscillation, Color, Detail]
        // 9 genes (-9 to +9 range roughly)
        let parentGenes = [50, 0.5, 0.7, 3, 1, 0, 180, 5];
        let biomorphs = []; // Array of 9 (1 parent + 8 children)

        function init() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            resetEvolution();
        }

        function resetEvolution() {
            generation = 0;
            parentGenes = [50, 0.5, 0.7, 3, 1, 0, 180, 5];
            spawnGeneration();
        }

        function mutate(genes) {
            let newGenes = [...genes];
            // Mutate one gene randomly
            const geneIdx = Math.floor(Math.random() * genes.length);
            const mutation = (Math.random() - 0.5) * 0.5; // Small change
            
            // Apply restrictions
            if(geneIdx === 3) newGenes[3] = Math.max(2, Math.min(6, Math.round(newGenes[3] + (Math.random()>0.5?1:-1)))); // Integer branches
            else newGenes[geneIdx] += mutation;
            
            return newGenes;
        }

        function spawnGeneration() {
            biomorphs = [];
            // Center: Parent (Perfect Copy)
            biomorphs.push({ genes: parentGenes, x: width/2, y: height/2, scale: 1.5 });
            
            // 8 Children (Mutants) in a circle
            for(let i=0; i<8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const dist = Math.min(width, height) * 0.3;
                biomorphs.push({ 
                    genes: mutate(parentGenes), 
                    x: width/2 + Math.cos(angle) * dist, 
                    y: height/2 + Math.sin(angle) * dist,
                    scale: 0.8
                });
            }
            
            document.getElementById('gen').innerText = generation;
        }

        function drawBiomorph(b) {
            const g = b.genes;
            const len = Math.abs(g[0]);
            const angle = g[1];
            const ratio = Math.abs(g[2]); // Can be > 1 for explosive growth
            const branches = Math.floor(g[3]);
            const hue = Math.abs(g[6]) % 360;
            const depth = Math.min(8, Math.floor(Math.abs(g[7])));

            ctx.save();
            ctx.translate(b.x, b.y);
            ctx.scale(b.scale, b.scale);
            
            ctx.strokeStyle = `hsla(${hue}, 70%, 60%, 0.8)`;
            ctx.lineWidth = 1;
            ctx.beginPath();
            
            drawBranch(0, 0, -Math.PI/2, len, angle, ratio, branches, depth);
            
            ctx.stroke();
            ctx.restore();
        }

        function drawBranch(x, y, dir, len, ang, rat, br, d) {
            if(d <= 0) return;
            
            const endX = x + Math.cos(dir) * len;
            const endY = y + Math.sin(dir) * len;
            
            ctx.moveTo(x, y);
            ctx.lineTo(endX, endY);
            
            // Recursive split
            const offset = (br - 1) * ang / 2;
            for(let i=0; i<br; i++) {
                const newDir = dir - offset + i * ang;
                drawBranch(endX, endY, newDir, len * rat, ang, rat, br, d-1);
            }
        }

        let autoTime = 0;

        function animate() {
            ctx.fillStyle = '#080c10';
            ctx.fillRect(0, 0, width, height);

            // Draw connecting lines (family tree)
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.beginPath();
            for(let i=1; i<biomorphs.length; i++) {
                ctx.moveTo(biomorphs[0].x, biomorphs[0].y);
                ctx.lineTo(biomorphs[i].x, biomorphs[i].y);
            }
            ctx.stroke();

            // Draw creatures
            biomorphs.forEach(drawBiomorph);

            // Auto-Evolve logic
            autoTime++;
            if(autoTime > 200) { // Every ~3 seconds
                // Select a random child (The Blind Watchmaker has no foresight)
                // Or maybe select the "largest" one to simulate some fitness?
                // Let's pick random to show drift.
                const survivorIdx = Math.floor(Math.random() * 8) + 1; // Pick 1-8 (Child)
                parentGenes = biomorphs[survivorIdx].genes;
                generation++;
                spawnGeneration();
                autoTime = 0;
            }

            requestAnimationFrame(animate);
        }
        
        // Interaction: User plays God
        canvas.addEventListener('mousedown', (e) => {
            const mx = e.clientX;
            const my = e.clientY;
            
            // Check which biomorph was clicked
            for(let b of biomorphs) {
                const dist = Math.hypot(b.x - mx, b.y - my);
                if(dist < 100) {
                    parentGenes = b.genes;
                    generation++;
                    spawnGeneration();
                    autoTime = 0; // Reset auto timer
                    break;
                }
            }
        });

        window.addEventListener('resize', init);
        init();
        animate();
    </script>
</body>
</html>