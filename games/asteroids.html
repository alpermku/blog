<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Rocks - Arcade</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&display=swap');

        *{margin:0;padding:0;box-sizing:border-box}
        html,body{width:100%;height:100%;overflow:hidden;touch-action:none}
        body{background:#020208;font-family:'JetBrains Mono',monospace;color:#fff;user-select:none;-webkit-user-select:none}

        canvas{display:block;position:fixed;top:0;left:0}

        .ui{position:fixed;z-index:10;pointer-events:none;width:100%;height:100%}
        .hud{position:absolute;top:12px;left:50%;transform:translateX(-50%);display:flex;gap:24px;align-items:center}
        .game-title{font-family:'Press Start 2P',cursive;font-size:12px;color:#f80;text-shadow:0 0 8px rgba(255,136,0,0.5)}
        .hud-score{font-family:'Press Start 2P',cursive;font-size:14px;color:#fff}
        .hud-level{font-size:11px;color:#0ff}
        .hud-lives{font-size:14px;letter-spacing:4px}

        .overlay{position:fixed;top:0;left:0;width:100%;height:100%;display:none;flex-direction:column;justify-content:center;align-items:center;background:rgba(2,2,8,0.9);z-index:20;pointer-events:all;text-align:center;padding:20px}
        .overlay.show{display:flex}
        .overlay h1{font-family:'Press Start 2P',cursive;font-size:20px;color:#f80;text-shadow:0 0 15px rgba(255,136,0,0.5);margin-bottom:12px}
        .overlay p{font-size:12px;color:rgba(255,255,255,0.6);margin:3px 0}
        .overlay .blink{margin-top:20px;font-family:'Press Start 2P',cursive;font-size:9px;color:#f80;animation:blink 1.2s infinite}
        .big-score{font-family:'Press Start 2P',cursive;font-size:28px;color:#ff0;margin:10px 0}
        .new-best{color:#0f8;font-size:11px}

        .back-link{position:fixed;bottom:14px;left:50%;transform:translateX(-50%);z-index:30;font-size:11px;color:rgba(255,255,255,0.2);text-decoration:none;pointer-events:all;transition:color 0.3s}
        .back-link:hover{color:#f80}

        .touch-zone-move{position:fixed;bottom:0;left:0;width:45%;height:40%;z-index:5;pointer-events:all;display:none}
        .touch-zone-aim{position:fixed;bottom:0;right:0;width:45%;height:40%;z-index:5;pointer-events:all;display:none}
        .mobile-hint{display:none;position:fixed;bottom:42%;left:50%;transform:translateX(-50%);z-index:11;font-size:9px;color:rgba(255,255,255,0.2);text-align:center;pointer-events:none}

        @media(pointer:coarse){
            .touch-zone-move,.touch-zone-aim{display:block}
            .mobile-hint{display:block}
        }

        @keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
    </style>
</head>
<body>

<canvas id="c"></canvas>

<div class="ui">
    <div class="hud">
        <span class="game-title">NEON ROCKS</span>
        <span class="hud-score" id="hudScore">0</span>
        <span class="hud-level" id="hudLevel">WAVE 1</span>
        <span class="hud-lives" id="hudLives">â™¥â™¥â™¥</span>
    </div>
</div>

<div class="touch-zone-move" id="moveZone"></div>
<div class="touch-zone-aim" id="aimZone"></div>
<div class="mobile-hint">LEFT: Move Â· RIGHT: Aim & Auto-fire</div>

<div class="overlay show" id="startScreen">
    <h1>ğŸš€ NEON ROCKS</h1>
    <p>Destroy asteroids Â· Collect minerals Â· Survive</p>
    <p style="margin-top:6px">Desktop: WASD/Arrows + Mouse aim + Click fire</p>
    <p>Mobile: Left stick move Â· Right stick aim & auto-fire</p>
    <p style="color:#f80;margin-top:8px">Endless waves Â· High score chase</p>
    <p class="blink">TAP OR PRESS ANY KEY</p>
</div>

<div class="overlay" id="deathScreen">
    <h1 style="color:#f44">DESTROYED</h1>
    <div class="big-score" id="deathScore">0</div>
    <p>Wave: <span id="deathWave">1</span></p>
    <p id="bestLine"></p>
    <p id="newBest" class="new-best" style="display:none">ğŸ† NEW BEST!</p>
    <p class="blink">TAP OR PRESS ANY KEY</p>
</div>

<a href="../games.html" class="back-link">â† Back to Arcade</a>

<script>
const C = document.getElementById('c');
const X = C.getContext('2d');
let W, H;
const isMobile = matchMedia('(pointer:coarse)').matches;

function resize() { W = C.width = window.innerWidth; H = C.height = window.innerHeight; }
resize(); window.addEventListener('resize', resize);

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state = 'start';
let score, wave, lives, ship, asteroids, bullets, minerals, particles, bgStars;
let fireTimer, invTimer, frame;
let best = parseInt(localStorage.getItem('nr_best') || '0');

const FRICTION = 0.985;
const SHIP_SIZE = 14;
const THRUST = 0.13;
const BULLET_SPD = 9;
const FIRE_RATE = 10;

// â”€â”€â”€ INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const keys = {};
const mouse = { x: W/2, y: H/2, down: false };
let moveVec = { x: 0, y: 0 };
let aimVec = { x: 0, y: 0, active: false };
let autoFire = false;

window.addEventListener('keydown', e => { keys[e.code] = true; if (state !== 'playing') startPlaying(); });
window.addEventListener('keyup', e => keys[e.code] = false);
window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
window.addEventListener('mousedown', e => { if(e.button===0) mouse.down = true; });
window.addEventListener('mouseup', e => { if(e.button===0) mouse.down = false; });
document.addEventListener('click', () => { if (state !== 'playing') startPlaying(); });
document.addEventListener('contextmenu', e => e.preventDefault());
document.body.addEventListener('touchmove', e => e.preventDefault(), {passive:false});

// â”€â”€â”€ TOUCH JOYSTICKS â”€â”€â”€â”€â”€â”€â”€â”€
let moveTouchId = null, aimTouchId = null;
let moveBase = null, aimBase = null;

const moveZone = document.getElementById('moveZone');
const aimZone = document.getElementById('aimZone');

moveZone.addEventListener('touchstart', e => {
    e.preventDefault();
    if (state !== 'playing') { startPlaying(); return; }
    const t = e.changedTouches[0];
    moveTouchId = t.identifier;
    moveBase = { x: t.clientX, y: t.clientY };
}, {passive:false});

moveZone.addEventListener('touchmove', e => {
    e.preventDefault();
    for (const t of e.changedTouches) {
        if (t.identifier === moveTouchId && moveBase) {
            const dx = t.clientX - moveBase.x;
            const dy = t.clientY - moveBase.y;
            const dist = Math.hypot(dx, dy);
            const maxR = 50;
            if (dist > 5) {
                const c = Math.min(dist, maxR);
                moveVec.x = (dx / dist) * (c / maxR);
                moveVec.y = (dy / dist) * (c / maxR);
            } else { moveVec.x = 0; moveVec.y = 0; }
        }
    }
}, {passive:false});

moveZone.addEventListener('touchend', e => {
    for (const t of e.changedTouches) {
        if (t.identifier === moveTouchId) { moveTouchId = null; moveBase = null; moveVec.x = 0; moveVec.y = 0; }
    }
});
moveZone.addEventListener('touchcancel', () => { moveTouchId = null; moveBase = null; moveVec.x = 0; moveVec.y = 0; });

aimZone.addEventListener('touchstart', e => {
    e.preventDefault();
    if (state !== 'playing') { startPlaying(); return; }
    const t = e.changedTouches[0];
    aimTouchId = t.identifier;
    aimBase = { x: t.clientX, y: t.clientY };
    aimVec.active = true; autoFire = true;
}, {passive:false});

aimZone.addEventListener('touchmove', e => {
    e.preventDefault();
    for (const t of e.changedTouches) {
        if (t.identifier === aimTouchId && aimBase) {
            const dx = t.clientX - aimBase.x;
            const dy = t.clientY - aimBase.y;
            const dist = Math.hypot(dx, dy);
            if (dist > 8) {
                aimVec.x = dx / dist; aimVec.y = dy / dist;
                aimVec.active = true;
                ship.angle = Math.atan2(dy, dx);
            }
        }
    }
}, {passive:false});

aimZone.addEventListener('touchend', e => {
    for (const t of e.changedTouches) {
        if (t.identifier === aimTouchId) { aimTouchId = null; aimBase = null; aimVec.active = false; autoFire = false; }
    }
});
aimZone.addEventListener('touchcancel', () => { aimTouchId = null; aimBase = null; aimVec.active = false; autoFire = false; });

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init() {
    score = 0; wave = 0; lives = 3; frame = 0; fireTimer = 0; invTimer = 0;
    ship = { x: W/2, y: H/2, angle: -Math.PI/2, vx: 0, vy: 0, thrusting: false };
    asteroids = []; bullets = []; minerals = []; particles = [];
    bgStars = [];
    for (let i = 0; i < 60; i++) bgStars.push({ x: Math.random()*W, y: Math.random()*H, r: Math.random()*1.2+0.3, b: Math.random() });
    nextWave();
    updateHUD();
}

function nextWave() {
    wave++;
    const count = 3 + wave;
    for (let i = 0; i < count; i++) {
        let x, y;
        do { x = Math.random()*W; y = Math.random()*H; } while (Math.hypot(x-ship.x, y-ship.y) < 150);
        spawnAsteroid(x, y, 3);
    }
    document.getElementById('hudLevel').textContent = 'WAVE ' + wave;
}

function spawnAsteroid(x, y, size) {
    const speed = (1 + wave*0.15) * (4-size)*0.5 + Math.random()*0.5;
    const angle = Math.random() * Math.PI * 2;
    const verts = [];
    const nv = 8 + Math.floor(Math.random()*5);
    const baseR = size * 12;
    for (let i = 0; i < nv; i++) {
        const a = (i/nv)*Math.PI*2;
        verts.push({ x: Math.cos(a)*baseR*(0.7+Math.random()*0.5), y: Math.sin(a)*baseR*(0.7+Math.random()*0.5) });
    }
    const colors = ['#f80','#0ff','#f0f','#8f0'];
    asteroids.push({
        x, y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed,
        size, verts, radius: baseR,
        rot: 0, rotSpeed: (Math.random()-0.5)*0.02,
        color: colors[Math.floor(Math.random()*colors.length)]
    });
}

function wrap(o) {
    if(o.x<-40)o.x=W+40; if(o.x>W+40)o.x=-40;
    if(o.y<-40)o.y=H+40; if(o.y>H+40)o.y=-40;
}

function startPlaying() {
    if (state !== 'start' && state !== 'dead') return;
    document.querySelectorAll('.overlay').forEach(o => o.classList.remove('show'));
    state = 'playing';
    init();
}

// â”€â”€â”€ UPDATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function update() {
    if (state !== 'playing') return;
    frame++;

    // â”€â”€ Movement â”€â”€
    let dx = 0, dy = 0;
    if (isMobile) {
        dx = moveVec.x; dy = moveVec.y;
    } else {
        if (keys['KeyW']||keys['ArrowUp']) dy -= 1;
        if (keys['KeyS']||keys['ArrowDown']) dy += 1;
        if (keys['KeyA']||keys['ArrowLeft']) dx -= 1;
        if (keys['KeyD']||keys['ArrowRight']) dx += 1;
        if (dx||dy) { const l = Math.hypot(dx,dy); dx/=l; dy/=l; }
    }

    ship.thrusting = Math.abs(dx) > 0.05 || Math.abs(dy) > 0.05;
    if (ship.thrusting) {
        ship.vx += dx * THRUST;
        ship.vy += dy * THRUST;
        // Thrust particles
        if (frame % 2 === 0) {
            const ba = Math.atan2(-dy, -dx);
            particles.push({
                x: ship.x + Math.cos(ba)*SHIP_SIZE*0.8,
                y: ship.y + Math.sin(ba)*SHIP_SIZE*0.8,
                vx: Math.cos(ba)*3+(Math.random()-0.5)*2,
                vy: Math.sin(ba)*3+(Math.random()-0.5)*2,
                life: 15, color: '#f80', size: 2
            });
        }
    }
    ship.vx *= FRICTION; ship.vy *= FRICTION;
    ship.x += ship.vx; ship.y += ship.vy;
    wrap(ship);

    // â”€â”€ Aim â”€â”€
    if (!isMobile) {
        ship.angle = Math.atan2(mouse.y - ship.y, mouse.x - ship.x);
    }
    // Mobile angle set in touch handler

    // â”€â”€ Fire â”€â”€
    if (fireTimer > 0) fireTimer--;
    const wantsFire = isMobile ? autoFire && aimVec.active : mouse.down;
    if (wantsFire && fireTimer <= 0) {
        fireTimer = FIRE_RATE;
        bullets.push({
            x: ship.x + Math.cos(ship.angle)*SHIP_SIZE,
            y: ship.y + Math.sin(ship.angle)*SHIP_SIZE,
            vx: Math.cos(ship.angle)*BULLET_SPD + ship.vx*0.3,
            vy: Math.sin(ship.angle)*BULLET_SPD + ship.vy*0.3,
            life: 60
        });
        // Recoil
        ship.x -= Math.cos(ship.angle)*2;
        ship.y -= Math.sin(ship.angle)*2;
        // Muzzle flash
        for (let i=0;i<3;i++) particles.push({
            x: ship.x+Math.cos(ship.angle)*18, y: ship.y+Math.sin(ship.angle)*18,
            vx:(Math.random()-0.5)*3+Math.cos(ship.angle)*3,
            vy:(Math.random()-0.5)*3+Math.sin(ship.angle)*3,
            life:10, color:'#0ff', size:1.5
        });
    }

    if (invTimer > 0) invTimer--;

    // â”€â”€ Bullets â”€â”€
    for (let i=bullets.length-1;i>=0;i--) {
        const b = bullets[i];
        b.x += b.vx; b.y += b.vy; b.life--;
        wrap(b);
        if (b.life<=0){bullets.splice(i,1);continue;}
        // Trail
        if(Math.random()>0.6) particles.push({x:b.x,y:b.y,vx:0,vy:0,life:6,color:'#0ff',size:1});

        for (let j=asteroids.length-1;j>=0;j--) {
            const a = asteroids[j];
            if (Math.hypot(b.x-a.x,b.y-a.y) < a.radius) {
                bullets.splice(i,1);
                const pts = (4-a.size)*25*wave;
                score += pts;
                for(let k=0;k<8+a.size*3;k++) particles.push({
                    x:a.x,y:a.y,vx:(Math.random()-0.5)*8,vy:(Math.random()-0.5)*8,
                    life:25+Math.random()*15,color:a.color,size:1+Math.random()*2
                });
                if(a.size>1){for(let s=0;s<2;s++)spawnAsteroid(a.x,a.y,a.size-1);}
                else if(Math.random()<0.4){minerals.push({x:a.x,y:a.y,life:300,size:6});}
                asteroids.splice(j,1);
                updateHUD();
                break;
            }
        }
    }

    // â”€â”€ Minerals â”€â”€
    for(let i=minerals.length-1;i>=0;i--){
        const m=minerals[i]; m.life--;
        if(m.life<=0){minerals.splice(i,1);continue;}
        if(Math.hypot(ship.x-m.x,ship.y-m.y)<SHIP_SIZE+m.size){
            score+=100*wave; minerals.splice(i,1);
            for(let k=0;k<6;k++)particles.push({x:m.x,y:m.y,vx:(Math.random()-0.5)*5,vy:(Math.random()-0.5)*5,life:15,color:'#0f0',size:2});
            if(score>0&&score%5000<200&&lives<5)lives++;
            updateHUD();
        }
    }

    // â”€â”€ Asteroids â”€â”€
    asteroids.forEach(a=>{
        a.x+=a.vx;a.y+=a.vy;a.rot+=a.rotSpeed;wrap(a);
        if(invTimer<=0&&Math.hypot(ship.x-a.x,ship.y-a.y)<SHIP_SIZE+a.radius*0.7){
            lives--; invTimer=120;
            for(let k=0;k<20;k++)particles.push({x:ship.x,y:ship.y,vx:(Math.random()-0.5)*10,vy:(Math.random()-0.5)*10,life:35,color:'#0ff',size:2});
            ship.x=W/2;ship.y=H/2;ship.vx=0;ship.vy=0;
            if(lives<=0){gameOver();return;}
            updateHUD();
        }
    });

    // â”€â”€ Particles â”€â”€
    for(let i=particles.length-1;i>=0;i--){const p=particles[i];p.x+=p.vx;p.y+=p.vy;p.vx*=0.97;p.vy*=0.97;p.life--;if(p.life<=0)particles.splice(i,1);}

    if(asteroids.length===0)nextWave();
}

// â”€â”€â”€ DRAW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function draw() {
    X.fillStyle = '#020208';
    X.fillRect(0,0,W,H);

    // BG stars
    bgStars.forEach(s=>{s.b+=0.005;X.fillStyle=`rgba(255,200,100,${0.15+Math.sin(s.b)*0.1})`;X.beginPath();X.arc(s.x,s.y,s.r,0,Math.PI*2);X.fill();});

    // Asteroids
    asteroids.forEach(a=>{
        X.save();X.translate(a.x,a.y);X.rotate(a.rot);
        X.strokeStyle=a.color;X.lineWidth=1.5;X.shadowBlur=6;X.shadowColor=a.color;
        X.beginPath();a.verts.forEach((v,i)=>X[i===0?'moveTo':'lineTo'](v.x,v.y));X.closePath();X.stroke();
        X.shadowBlur=0;X.restore();
    });

    // Minerals
    minerals.forEach(m=>{
        const pulse=Math.sin(frame*0.15)*0.3+0.7;
        X.globalAlpha=Math.min(1,m.life/60)*pulse;X.fillStyle='#0f0';X.shadowBlur=10;X.shadowColor='#0f0';
        X.beginPath();X.moveTo(m.x,m.y-m.size);X.lineTo(m.x+m.size*0.7,m.y);X.lineTo(m.x,m.y+m.size);X.lineTo(m.x-m.size*0.7,m.y);X.closePath();X.fill();
        X.shadowBlur=0;X.globalAlpha=1;
    });

    // Bullets
    bullets.forEach(b=>{X.fillStyle='#fff';X.shadowBlur=6;X.shadowColor='#0ff';X.beginPath();X.arc(b.x,b.y,2.5,0,Math.PI*2);X.fill();X.shadowBlur=0;});

    // Ship
    if(state==='playing'){
        if(invTimer>0&&Math.floor(frame/4)%2===0){}else{
            X.save();X.translate(ship.x,ship.y);

            // Thrust flame
            if(ship.thrusting){
                const ba=ship.angle+Math.PI;
                X.save();X.rotate(ba);
                X.fillStyle='#f80';X.shadowBlur=10;X.shadowColor='#f80';
                X.beginPath();X.moveTo(SHIP_SIZE*0.3,-4);X.lineTo(SHIP_SIZE*(0.8+Math.random()*0.4),0);X.lineTo(SHIP_SIZE*0.3,4);X.closePath();X.fill();
                X.shadowBlur=0;X.restore();
            }

            X.rotate(ship.angle);
            X.strokeStyle='#0ff';X.lineWidth=2;X.shadowBlur=10;X.shadowColor='#0ff';
            X.beginPath();X.moveTo(SHIP_SIZE,0);X.lineTo(-SHIP_SIZE*0.7,SHIP_SIZE*0.6);X.lineTo(-SHIP_SIZE*0.4,0);X.lineTo(-SHIP_SIZE*0.7,-SHIP_SIZE*0.6);X.closePath();X.stroke();
            X.shadowBlur=0;
            X.fillStyle='#0ff';X.beginPath();X.arc(0,0,2,0,Math.PI*2);X.fill();
            X.restore();
        }
    }

    // Particles
    particles.forEach(p=>{X.globalAlpha=Math.max(0,p.life/30);X.fillStyle=p.color;X.fillRect(p.x-p.size/2,p.y-p.size/2,p.size,p.size);});
    X.globalAlpha=1;

    // â”€â”€ Crosshair (desktop) â”€â”€
    if(!isMobile&&state==='playing'){
        X.strokeStyle='rgba(255,136,0,0.4)';X.lineWidth=1;
        X.beginPath();X.arc(mouse.x,mouse.y,12,0,Math.PI*2);X.stroke();
        X.beginPath();X.moveTo(mouse.x-18,mouse.y);X.lineTo(mouse.x-8,mouse.y);X.stroke();
        X.beginPath();X.moveTo(mouse.x+8,mouse.y);X.lineTo(mouse.x+18,mouse.y);X.stroke();
        X.beginPath();X.moveTo(mouse.x,mouse.y-18);X.lineTo(mouse.x,mouse.y-8);X.stroke();
        X.beginPath();X.moveTo(mouse.x,mouse.y+8);X.lineTo(mouse.x,mouse.y+18);X.stroke();
    }

    // â”€â”€ Mobile joystick visuals â”€â”€
    if(isMobile){
        if(moveBase&&moveTouchId!==null){
            X.strokeStyle='rgba(0,255,255,0.15)';X.lineWidth=2;
            X.beginPath();X.arc(moveBase.x,moveBase.y,50,0,Math.PI*2);X.stroke();
            X.fillStyle='rgba(0,255,255,0.2)';
            X.beginPath();X.arc(moveBase.x+moveVec.x*50,moveBase.y+moveVec.y*50,18,0,Math.PI*2);X.fill();
        }
        if(aimBase&&aimTouchId!==null){
            X.strokeStyle='rgba(255,136,0,0.15)';X.lineWidth=2;
            X.beginPath();X.arc(aimBase.x,aimBase.y,50,0,Math.PI*2);X.stroke();
            X.fillStyle='rgba(255,136,0,0.2)';
            const ax=aimVec.active?aimVec.x*40:0, ay=aimVec.active?aimVec.y*40:0;
            X.beginPath();X.arc(aimBase.x+ax,aimBase.y+ay,18,0,Math.PI*2);X.fill();
        }
    }

    requestAnimationFrame(draw);
}

function updateHUD() {
    document.getElementById('hudScore').textContent = score;
    document.getElementById('hudLives').textContent = 'â™¥'.repeat(lives)+'â™¡'.repeat(Math.max(0,5-lives));
}

function gameOver() {
    state='dead';
    const isNew=score>best;
    if(isNew){best=score;localStorage.setItem('nr_best',best);}
    document.getElementById('deathScore').textContent=score;
    document.getElementById('deathWave').textContent=wave;
    document.getElementById('bestLine').textContent='Best: '+best;
    document.getElementById('newBest').style.display=isNew?'block':'none';
    document.getElementById('deathScreen').classList.add('show');
}

// â”€â”€â”€ CURSOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if(!isMobile) C.style.cursor='none';

// â”€â”€â”€ RUN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
init();
setInterval(update,1000/60);
draw();
</script>
</body>
</html>
